# WaniKani API v2 Reference Documentation

## Introduction
The WaniKani API v2 provides a robust and comprehensive RESTful interface for developers to interact with user data, study materials, and progress statistics from the WaniKani platform. This API is designed to support the creation of third-party applications, including mobile apps, browser extensions, and web-based tools that enhance the kanji and vocabulary learning experience. This document outlines the core principles, authentication mechanisms, and primary endpoints of the API to facilitate smooth integration.

## 1. Authentication
Accessing the WaniKani API v2 requires an API key, which can be generated by the user through their account settings on the WaniKani website. Specifically, users can find these settings under "Settings" > "API Tokens". There are two types of tokens: personal access tokens and OAuth tokens. For most standalone applications, personal access tokens are the standard choice.

Once a token is obtained, it must be included in the header of every request made to the API. The API uses Bearer Token authentication. The token should be passed in the `Authorization` header as follows:

```http
Authorization: Bearer <your_api_token_here>
```

It is crucial to keep this token secure and never share it publicly, as it provides full access to the user's WaniKani data.

## 2. Required Headers
In addition to the `Authorization` header, the WaniKani API v2 requires a specific revision header to ensure compatibility with the current API schema. This allows the API to evolve without breaking existing integrations that depend on a specific version of the data structure.

The mandatory header is:
```http
Wanikani-Revision: 20170710
```

Failure to include this header or providing an incorrect revision date will result in an error response from the server. It is best practice to include this header in all API calls.

## 3. Base URL
All API requests are made relative to the following base URL:

`https://api.wanikani.com/v2`

Requests should be made over HTTPS to ensure that the authentication token and user data remain encrypted during transit.

## 4. Rate Limiting
To ensure fair usage and maintain server stability, the WaniKani API v2 implements rate limiting for all clients.

- **Limit**: Currently, the API allows up to 60 requests per minute.
- **Exceeding the Limit**: If a client exceeds this limit, the API will return a `429 Too Many Requests` status code.
- **Handling Rate Limits**: Responses with a 429 status code will include a `Retry-After` header. This header specifies the number of seconds the client must wait before making another request.
- **Best Practices**: Developers are encouraged to implement back-off strategies and caching mechanisms to minimize the number of requests and avoid hitting the rate limit. Checking the `X-RateLimit-Limit` and `X-RateLimit-Remaining` headers (if available) can also help manage request flow.

## 5. Response Envelope Structure
The WaniKani API v2 returns data in a consistent JSON envelope structure. This structure helps clients understand the type of data being returned and provides metadata about the request.

### Collection Object
When requesting a list of resources (e.g., all subjects or assignments), the API returns a collection object:

```json
{
  "object": "collection",
  "url": "https://api.wanikani.com/v2/subjects",
  "pages": {
    "per_page": 500,
    "next_url": "https://api.wanikani.com/v2/subjects?after_id=500",
    "previous_url": null
  },
  "total_count": 9400,
  "data_updated_at": "2023-10-27T15:45:00.000000Z",
  "data": [
    {
      "id": 1,
      "object": "radical",
      "url": "https://api.wanikani.com/v2/subjects/1",
      "data_updated_at": "2023-05-12T10:00:00.000000Z",
      "data": {
        "created_at": "2012-02-27T19:08:16.000000Z",
        "level": 1,
        "slug": "ground",
        "characters": "一"
      }
    }
  ]
}
```

### Resource Object
When requesting a specific resource by ID, the API returns a resource object:

```json
{
  "id": 1,
  "object": "radical",
  "url": "https://api.wanikani.com/v2/subjects/1",
  "data_updated_at": "2023-05-12T10:00:00.000000Z",
  "data": {
    "level": 1,
    "slug": "ground",
    "characters": "一"
  }
}
```

The `object` field identifies the type of data, and the `data` field contains the actual resource attributes.

## 6. Pagination
The API uses cursor-based pagination for collections. The `pages` object in a collection response contains the following fields:
- `per_page`: The number of items returned in the current page.
- `next_url`: The URL for the next page of results. If this is `null`, you have reached the end of the collection.
- `previous_url`: The URL for the previous page of results.

To fetch an entire collection, clients should recursively follow the `next_url` until it becomes `null`. This approach is more reliable than offset-based pagination for datasets that change frequently.

## 7. Key Endpoints

### GET /user
Returns a summary of the user's account information, including their username, current level, subscription status, and preferences. This is often the first call made to verify the validity of an API key.

### GET /subjects
Provides access to the vast library of WaniKani content, including radicals, kanji, and vocabulary. Users can filter subjects by level, type, or slug. This endpoint is essential for building a local dictionary or study materials.

### GET /assignments
Assignments track a user's progress through the WaniKani curriculum. Each assignment links a user to a specific subject and records their current SRS stage, next review date, and whether the subject is "passed" or "burned".

### GET /reviews
This endpoint provides a history of review sessions. It records the outcome of each individual review (meaning and reading correctness) and the resulting SRS stage transition. This data is invaluable for statistical analysis of user performance.

### GET /summary
Returns a snapshot of currently available and upcoming lessons and reviews. This is typically used to populate a dashboard view, showing the user exactly what they need to study right now.

## 8. Error Handling
The WaniKani API v2 uses standard HTTP status codes to indicate the success or failure of an API request.

- **200 OK**: The request was successful.
- **401 Unauthorized**: The API key is missing or invalid.
- **403 Forbidden**: The authenticated user does not have permission to access the requested resource.
- **404 Not Found**: The requested resource could not be found.
- **422 Unprocessable Entity**: The request was well-formed but contains semantic errors (e.g., invalid parameters).
- **429 Too Many Requests**: Rate limit exceeded. Check the `Retry-After` header.
- **500 Internal Server Error**: An unexpected error occurred on the server.
- **503 Service Unavailable**: The server is temporarily offline for maintenance.

Developers should gracefully handle these errors in their applications, providing informative feedback to the user where appropriate.
